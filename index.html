<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Анализ Квадратичной Функции</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            line-height: 1.5;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: var(--card);
            padding: 20px;
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        h1 {
            text-align: center;
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        /* Поле ввода */
        .input-box {
            display: flex;
            align-items: center;
            background: #f1f5f9;
            padding: 15px;
            border-radius: 16px;
            margin-bottom: 15px;
        }

        .input-box span {
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 10px;
        }

        input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 1.3rem;
            font-family: 'Courier New', monospace;
            outline: none;
        }

        /* Клавиатура */
        .keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .key {
            background: #fff;
            border: 1px solid #e2e8f0;
            padding: 15px 5px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.1s;
            touch-action: manipulation;
            font-weight: 500;
        }

        .key:active {
            background: #e2e8f0;
            transform: scale(0.95);
        }

        .key.action {
            grid-column: span 4;
            background: var(--primary);
            color: white;
            border: none;
            font-weight: bold;
            margin-top: 5px;
        }

        .key.red { color: #ef4444; }

        /* Стили вывода */
        .step {
            background: #fdfdfd;
            border-left: 5px solid var(--primary);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .step h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .step p { margin: 5px 0; }

        .highlight {
            font-weight: bold;
            color: #000;
        }

        /* Таблица */
        .table-container {
            overflow-x: auto;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        td, th {
            border: 1px solid #e2e8f0;
            padding: 10px;
            text-align: center;
        }

        th { background: #f1f5f9; }

        .chart-wrap {
            height: 350px;
            margin-top: 20px;
        }

        .error {
            background: #fef2f2;
            color: #b91c1c;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Исследование параболы</h1>

    <div class="input-box">
        <span>y =</span>
        <input type="text" id="funcInput" value="-x^2 + 6x - 9" placeholder="Введите формулу">
    </div>

    <div class="keyboard">
        <button class="key" onclick="add('x')">x</button>
        <button class="key" onclick="add('^2')">x²</button>
        <button class="key" onclick="add('1/2')">½</button>
        <button class="key" onclick="add('+')">+</button>
        <button class="key" onclick="add('-')">−</button>
        <button class="key" onclick="add('(')">(</button>
        <button class="key" onclick="add(')')">)</button>
        <button class="key red" onclick="back()">⌫</button>
        <button class="key action" onclick="calculate()">ПОСТРОИТЬ И ИССЛЕДОВАТЬ</button>
    </div>

    <div id="resultArea"></div>

    <div class="chart-wrap">
        <canvas id="mainChart"></canvas>
    </div>
</div>

<script>
    let myChart = null;

    function add(v) { document.getElementById('funcInput').value += v; }
    function back() { 
        let current = document.getElementById('funcInput').value;
        document.getElementById('funcInput').value = current.slice(0, -1);
    }

    // Парсер для извлечения коэффициентов a, b, c
    function parseFunction(str) {
        let expression = str.replace(/ /g, '')
                            .replace(/½/g, '0.5')
                            .replace(/\^2/g, '**2');
        
        // Исправляем -x**2 на -1*(x**2) для JS и добавляем умножение
        expression = expression.replace(/-x/g, '-1*x');
        expression = expression.replace(/(\d)x/g, '$1*x');

        try {
            const f = (x) => new Function('x', `return ${expression}`)(x);
            const y0 = f(0);
            const y1 = f(1);
            const yn1 = f(-1);

            const c = y0;
            const a = (y1 + yn1 - 2 * c) / 2;
            const b = y1 - a - c;

            if (isNaN(a)) return null;
            return { a, b, c, f };
        } catch (e) { return null; }
    }

    function format(n) {
        if (Math.abs(n) < 0.001) return 0;
        return Number.isInteger(n) ? n : n.toFixed(2);
    }

    function calculate() {
        const input = document.getElementById('funcInput').value;
        const area = document.getElementById('resultArea');
        area.innerHTML = "";

        const res = parseFunction(input);

        if (!res || Math.abs(res.a) < 0.0001) {
            area.innerHTML = '<div class="error">Ошибка в формуле. Убедитесь, что это квадратичная функция (есть x²)</div>';
            return;
        }

        const { a, b, c, f } = res;
        const x0 = -b / (2 * a);
        const y0 = f(x0);
        const D = b * b - 4 * a * c;

        let html = "";

        // 1. Направление ветвей
        html += `<div class="step">
            <h3>1. Направление ветвей</h3>
            <p>Коэффициент <span class="highlight">a = ${format(a)}</span>.</p>
            <p>Так как коэффициент a ${a > 0 ? 'больше нуля' : 'меньше нуля'}, <b>ветви параболы направлены ${a > 0 ? 'вверх' : 'вниз'}</b>.</p>
        </div>`;

        // 2. Вершина и ось
        html += `<div class="step">
            <h3>2. Координаты вершины и ось симметрии</h3>
            <p>Абсцисса вершины (x₀) = -b / 2a = ${format(-b)} / ${format(2*a)} = <span class="highlight">${format(x0)}</span></p>
            <p>Ордината вершины (y₀) = f(x₀) = <span class="highlight">${format(y0)}</span></p>
            <p>Координаты вершины параболы: <span class="highlight">(${format(x0)}; ${format(y0)})</span></p>
            <p>Ось симметрии параболы: прямая <span class="highlight">x = ${format(x0)}</span></p>
        </div>`;

        // 3. Пересечение с осями
        let xPoints = "";
        let roots = [];
        if (D > 0) {
            let x1 = (-b + Math.sqrt(D)) / (2 * a);
            let x2 = (-b - Math.sqrt(D)) / (2 * a);
            roots = [x1, x2].sort((m, n) => m - n);
            xPoints = `функция имеет два нуля: x₁ = ${format(roots[0])}, x₂ = ${format(roots[1])}`;
        } else if (Math.abs(D) < 0.001) {
            roots = [x0];
            xPoints = `функция имеет один нуль: x = ${format(x0)}`;
        } else {
            xPoints = "график не пересекает ось абсцисс (нулей нет)";
        }

        html += `<div class="step">
            <h3>3. Точки пересечения с осями</h3>
            <p><b>С осью ординат (x = 0):</b> точка (0; ${format(c)})</p>
            <p><b>С осью абсцисс (y = 0):</b> ${xPoints}</p>
        </div>`;

        // 4. Полное исследование свойств
        let range = a > 0 ? `[${format(y0)}; +∞)` : `(-∞; ${format(y0)}]`;
        let increase = a > 0 ? `[${format(x0)}; +∞)` : `(-∞; ${format(x0)}]`;
        let decrease = a > 0 ? `(-∞; ${format(x0)}]` : `[${format(x0)}; +∞)`;
        
        let posNeg = "";
        if (D > 0) {
            if (a > 0) {
                posNeg = `<p>y > 0 (выше оси) на промежутках: (-∞; ${format(roots[0])}) ∪ (${format(roots[1])}; +∞)</p>
                          <p>y < 0 (ниже оси) на промежутке: (${format(roots[0])}; ${format(roots[1])})</p>`;
            } else {
                posNeg = `<p>y > 0 (выше оси) на промежутке: (${format(roots[0])}; ${format(roots[1])})</p>
                          <p>y < 0 (ниже оси) на промежутках: (-∞; ${format(roots[0])}) ∪ (${format(roots[1])}; +∞)</p>`;
            }
        } else {
            let sign = a > 0 ? "положительна (y > 0)" : "отрицательна (y < 0)";
            posNeg = `<p>Функция ${sign} на всей области определения ${D === 0 ? '(кроме вершины)' : ''}.</p>`;
        }

        html += `<div class="step">
            <h3>4. Свойства функции</h3>
            <p><b>Область определения:</b> (-∞; +∞)</p>
            <p><b>Область значений:</b> ${range}</p>
            <p><b>Промежуток возрастания:</b> ${increase}</p>
            <p><b>Промежуток убывания:</b> ${decrease}</p>
            <p><b>Промежутки знакопостоянства:</b></p>
            ${posNeg}
        </div>`;

        // 5. Таблица значений
        let table = `<div class="step">
            <h3>5. Таблица контрольных точек</h3>
            <div class="table-container">
                <table>
                    <tr><th>x</th>`;
        let rowY = "<tr><th>y</th>";
        for (let i = -3; i <= 3; i++) {
            let curX = Math.round(x0) + i;
            table += `<td>${curX}</td>`;
            rowY += `<td>${format(f(curX))}</td>`;
        }
        table += `</tr>${rowY}</tr></table></div></div>`;

        area.innerHTML = html + table;
        renderChart(f, x0);
    }

    function renderChart(f, x0) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (myChart) myChart.destroy();

        let labels = [];
        let data = [];
        for (let x = x0 - 5; x <= x0 + 5; x += 0.25) {
            labels.push(x.toFixed(1));
            data.push(f(x));
        }

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'График функции y(x)',
                    data: data,
                    borderColor: '#2563eb',
                    borderWidth: 3,
                    pointRadius: 0,
                    fill: false,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: { color: '#e2e8f0' },
                        ticks: { maxTicksLimit: 10 }
                    },
                    y: {
                        grid: { color: '#e2e8f0' }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    // Инициализация при загрузке
    window.onload = calculate;
</script>

</body>
</html>
